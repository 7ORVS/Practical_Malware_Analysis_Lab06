# Practical Malware Analysis Labs- Ch.6 Labs

## In this lab we will analyze some EXEs with IDA disassembler.
---
## Lab06-01.exe Questions:

---
1- What is the major code construct found in the only subroutine called
by main?

if we investigate **sub_401000** which called by main we will find that it calls a function to check the internet connection and then redirect the execution flow depends on the connection status. So the major construst is **if**

![](/pics/lab1_Subroutine_by_main.png)

---
2- What is the subroutine located at 0x40105F?

if we can see in image above this function is called in both two if branches after pushing two status strings into stack. So, if we dive into it we will see that

![](/pics/Lab1_0x40105F.png)

These two functions **__stbuf & __ftbuf** get my attention.
I search for __stbuf on google and find that these function are inside **printf()** implementation.

![](/pics/Lab1_printf.png)

So this function is printf()

---

3- What is the purpose of this program? <br>
This program is simply chech the internet connection and then print the status of connection.

---
## Lab06-02.exe Questions:

---
1- What operation does the first subroutine called by main perform?

The first subroutine called by main is **sub_401000**, and if we dive into it we will that it also check the internet connection.

![](/pics/Lab2_sub_401000.png)

---
2- What is the subroutine located at 0x40117F? <br>
If we look inside it also we will figure out that this is printf.

---
3- What does the second subroutine called by main do?

If there are internet connection, then main will call function **sub_401040**.

The first thing we will face in this function that this function calling **InternetOpenA** which Initializes an application's use of the WinINet functions.

And then it try to open a URL **http://www.practicalmalwareanalysis.com/cc.htm** using **InternetOpenUrlA** which Opens a resource specified by a complete FTP or HTTP URL
![](/pics/Lab2_sub_401040.png)

Depend on **InternetOpenUrlA** result it will return or it will a file from this URL using **InternetReadFile**
![](/pics/Lab2_InternetReadFileA.png)

And if this operation done succesfully it will make some if conditions.
![](/pics/Lab2_After_ReadingFile.png)

After these checks it will either get command from this file or not.
![](/pics/Lab2_GetCommand.png)

These other braches for elses simply it will close the operation handle which opened in if check.
![](/pics/Lab2_OtherBranches.png)

So this function try to read content or "Command" from file on URL to execute it.

---

4- What type of code construct is used in this subroutine?

If construct.

---

5- Are there any network-based indicators for this program? 

Yeah, this program try to connect to C2 server on internet to get command and execute it.

---

6- Are there any network-based indicators for this program?

This program try to connect to URL and read a content from it to get a command and execute it on the system.

---

